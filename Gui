-- Load Rayfield
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

if not Rayfield then
    warn("Failed to load Rayfield")
    return
end

-- Window (KEY SYSTEM INCLUDED)
local Window = Rayfield:CreateWindow({
    Name = "Vision Hub",
    LoadingTitle = "Vision Script",
    LoadingSubtitle = "by Vision",
    ConfigurationSaving = {
       Enabled = false,
       FileName = "Vision Script Hub"
    },
    Discord = {
       Enabled = true,
       Invite = "GYH92be25Z",
       RememberJoins = true
    },
    KeySystem = true,
    KeySettings = {
       Title = "Vision Script Hub | Key",
       Subtitle = "Link In Discord Server",
       Note = "Join Server From Misc Tab",
       FileName = "BladeBallKey",
       SaveKey = false,
       GrabKeyFromSite = true,
       Key = {"https://pastebin.com/raw/QZYyHa0H"}
    }
})

-- Tab
local MainTab = Window:CreateTab("Main", nil)
MainTab:CreateSection("Useful")

---------------------------------------------------------------------
-- AUTO METER RELEASE
---------------------------------------------------------------------

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

local AutoMeterEnabled = false
local meterConnection
local customMeterOffset = -1.27

local function getCharacter()
    return workspace:WaitForChild("Characters"):WaitForChild(LocalPlayer.Name)
end

local function fireShoot()
    local parkRemote = ReplicatedStorage:FindFirstChild("RemoteEvent")
    if parkRemote then
        parkRemote:FireServer({
            {
                {
                    "5",
                    { Shoot = false }
                }
            }
        })
    else
        ReplicatedStorage.Aero.AeroRemoteServices.InputService.Shoot:FireServer({ Shoot = false })
    end
end

local function connectMeter()
    if meterConnection then
        meterConnection:Disconnect()
    end

    local Character = getCharacter()

    meterConnection = Character:GetAttributeChangedSignal("meterOffset"):Connect(function()
        if not AutoMeterEnabled then return end

        local meterOffset = Character:GetAttribute("meterOffset")
        local hrp = Character:FindFirstChild("HumanoidRootPart")
        if not hrp then return end

        if hrp:FindFirstChild("VerticalMeter") and hrp.VerticalMeter.Enabled then
            if meterOffset.Y <= customMeterOffset then fireShoot() end

        elseif hrp:FindFirstChild("BatMeter") and hrp.BatMeter.Enabled then
            if meterOffset.Y <= customMeterOffset then fireShoot() end

        elseif hrp:FindFirstChild("RocketMeter") and hrp.RocketMeter.Enabled then
            if meterOffset.Y <= customMeterOffset then fireShoot() end

        elseif Character.Head:FindFirstChild("HoopMeter") and Character.Head.HoopMeter.Enabled then
            if meterOffset.Y >= -customMeterOffset then fireShoot() end

        elseif Character.Head:FindFirstChild("RobloxMeter") and Character.Head.RobloxMeter.Enabled then
            if meterOffset.X >= -customMeterOffset then fireShoot() end
        end
    end)
end

LocalPlayer.CharacterAdded:Connect(function()
    if AutoMeterEnabled then
        task.wait(1)
        connectMeter()
    end
end)

MainTab:CreateToggle({
    Name = "Auto Perfect",
    CurrentValue = false,
    Callback = function(Value)
        AutoMeterEnabled = Value
        if Value then
            connectMeter()
        elseif meterConnection then
            meterConnection:Disconnect()
        end
    end,
})

MainTab:CreateSlider({
    Name = "Meter Offset",
    Range = {-1.40, -0.70},
    Increment = 0.01,
    CurrentValue = customMeterOffset,
    Callback = function(Value)
        customMeterOffset = Value
    end,
})

---------------------------------------------------------------------
-- BASKETBALL SPEED BOOST (ADDED TO VISION HUB)
---------------------------------------------------------------------

MainTab:CreateSection("Movement")

local SpeedBoostEnabled = false
local SpeedBoostValue = 0
local BASE_SPEED = 13.818737296367772

local function getSpeedCharacter()
    local chars = workspace:FindFirstChild("Characters")
    if not chars then return end

    local char = chars:FindFirstChild(LocalPlayer.Name)
    if not char then return end

    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    return char, hrp
end

MainTab:CreateToggle({
    Name = "Speed With Ball",
    CurrentValue = false,
    Callback = function(Value)
        SpeedBoostEnabled = Value
        if not Value then
            local char = getSpeedCharacter()
            if char then
                char:SetAttribute("WalkSpeed", BASE_SPEED)
            end
        end
    end,
})

MainTab:CreateSlider({
    Name = "Speed Boost Amount",
    Range = {0, 50},
    Increment = 1,
    CurrentValue = 0,
    Callback = function(Value)
        SpeedBoostValue = Value
    end,
})

RunService.Heartbeat:Connect(function()
    if not SpeedBoostEnabled then return end

    local char, hrp = getSpeedCharacter()
    if not char or not hrp then return end

    local ball = hrp:FindFirstChild("Basketball")

    if ball and ball:IsA("Motor6D") and ball.Part1 and ball.Part1.Name == "Basketball" then
        char:SetAttribute("WalkSpeed", BASE_SPEED + SpeedBoostValue)
    else
        char:SetAttribute("WalkSpeed", BASE_SPEED)
    end
end)

---------------------------------------------------------------------
-- NOTIFY
---------------------------------------------------------------------

Rayfield:Notify({
    Title = "Vision Hub",
    Content = "Vision Hub Loaded",
    Duration = 4,
})
